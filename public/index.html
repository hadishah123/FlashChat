<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FlashChat ⚡</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #a1a1aa; border-radius: 6px; }
  </style>
</head>
<body class=" min-h-screen flex items-center justify-center font-sans p-4">
  <video autoplay muted loop class="fixed  top-0 left-0 w-full h-full object-cover z-[-1]">
    <source src="/assets/bg.mp4" type="video/mp4" />
    Your browser does not support HTML5 video.
  </video>
  <div class="bg-white shadow-xl rounded-2xl p-4 sm:p-6 w-full max-w-md flex flex-col">
    <h2 class="text-2xl font-bold text-center mb-4 bg-gradient-to-r from-blue-500 to-pink-500 text-transparent bg-clip-text">
      FlashChat ⚡
    </h2>

    <!-- Join Section -->
    <div id="joinSection" class="space-y-3 text-center">
      <input id="playerName" placeholder="Enter Your Name"
             class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm sm:text-base" />
      <input id="gameId" placeholder="Enter Room ID"
             class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm sm:text-base" />
      <button id="joinBtn"
              class="w-full text-white bg-gradient-to-r from-purple-500 to-pink-500 hover:bg-gradient-to-l focus:ring-4 focus:outline-none focus:ring-purple-200 font-medium rounded-lg text-sm sm:text-base px-5 py-2.5 transition ease-in-out">
        Join Room
      </button>
    </div>

    <!-- Chat Section -->
    <div id="chat" class="hidden flex flex-col h-[80vh] mt-4">
      <h3 id="roomTitle" class="text-lg font-semibold text-center mb-2 text-blue-700"></h3>
      <ul id="messages"
          class="flex-1 overflow-y-auto bg-gray-50 border rounded-lg p-3 space-y-2 text-sm sm:text-base"></ul>

      <div class="flex mt-3 gap-2">
        <input id="messageInput" placeholder="Type a message..."
               class="flex-1 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm sm:text-base" />
        <button id="sendBtn"
                class="bg-blue-500 text-white px-3 sm:px-4 py-2 rounded-lg hover:bg-blue-600 transition text-sm sm:text-base">
          Send
        </button>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const nameInput = document.getElementById("playerName");
    const idInput = document.getElementById("gameId");
    const joinBtn = document.getElementById("joinBtn");
    const chatDiv = document.getElementById("chat");
    const joinSection = document.getElementById("joinSection");
    const roomTitle = document.getElementById("roomTitle");
    const messages = document.getElementById("messages");
    const msgInput = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");

    let playerName = "";
    let gameId = "";

    joinBtn.onclick = () => {
      playerName = nameInput.value.trim();
      gameId = idInput.value.trim();
      if (!playerName || !gameId) return alert("Enter your name and room ID!");

      socket.emit("join_game", { gameId, name: playerName });
      roomTitle.textContent = `Room: ${gameId}`;
      joinSection.classList.add("hidden");
      chatDiv.classList.remove("hidden");
    };

    sendBtn.onclick = sendMessage;
    msgInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    function sendMessage() {
      const message = msgInput.value.trim();
      if (!message) return;
      socket.emit("chat_message", { gameId, name: playerName, message });
      msgInput.value = "";
    }

    socket.on("chat_message", ({ name, message }) => {
      const li = document.createElement("li");
      if (name === "System") {
        li.className = "text-gray-500 italic text-center";
        li.textContent = message;
      } else if (name === playerName) {
        li.className = "bg-blue-100 text-right rounded-lg px-3 py-1 ml-10";
        li.textContent = `You: ${message}`;
      } else {
        li.className = "bg-gray-200 rounded-lg px-3 py-1 mr-10";
        li.textContent = `${name}: ${message}`;
      }

      messages.appendChild(li);
      messages.scrollTop = messages.scrollHeight;
    });
  </script>
</body>
</html>